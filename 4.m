x = 0:1:255;
G1 = imread("grid.pgm");
G2 = imread("distgrid.pgm");
#H1 = imhist(G1);
#H2 = imhist(G2);
#{
G1 = ordfilt2(G1, 9, [0 0 1 0 0;
                       0 0 1 0 0;
                       1 1 1 1 1;
                       0 0 1 0 0;
                       0 0 1 0 0]);
G1 = 255 - G1;
G2 = G21 - (255 - G22) - (255 - G22);
G2(G2 < 255) = 0;
#}
I = G2;
C = detectHarrisFeatures(I);
imshow(I);
hold on
plot(corners.selectStrongest(50));
G21 = ordfilt2(G2, 9, [0 0 1 0 0;
                       0 0 1 0 0;
                       1 1 1 1 1;
                       0 0 1 0 0;
                       0 0 1 0 0]);
G22 = ordfilt2(G2, 12, [1 1 0 1 1;
                       1 1 1 1 1;
                       0 1 1 1 0;
                       1 1 1 1 1;
                       1 1 0 1 1]);
G22 = ordfilt2(G2, 1, [1 1 1; 1 1 1; 1 1 1]);
#imshow(bitand(G21, G22));
G2 = 255 - G2;
G2 = im2double(G2);
f = fspecial("sobel");
[Gx, Gy] = gradient(f);
[Gxx, Gxy] = gradient(Gx);
[Gyx, Gyy] = gradient(Gy);
lX = imfilter(G2, Gxx, "conv");
lY = imfilter(G2, Gxx', "conv");
lXY = imfilter(G2, imrotate(Gxx, 90), "conv");
lXY(lXY < 0.5) = 0;
#imshow(lX - lY);
lX = lX + 0.3 * lXY;
lX = ordfilt2(lX, 8, [1 0 0 0 0;
                      1 1 0 0 0;
                      1 1 1 1 1;
                      1 1 0 0 0;
                      1 0 0 0 0]);
lX(lX < 0.8) = 0;
#imshow(lX);
cc = bwconncomp(G22);
labeled = labelmatrix(cc);
RGB_label = label2rgb(labeled, @copper, 'c', 'shuffle');
#imshow(RGB_label,'InitialMagnification','fit')
#G2 = bwmorph(G2, "branchpoints");
imwrite(G1, "grid-med.pgm");
imwrite(G2, "distgrid-med.pgm");
#imshow(bitand(lX, lY));